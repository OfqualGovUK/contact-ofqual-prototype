{% extends "layout.html" %}

{% block pageTitle %}
  {{ pageHeading }} - {{serviceName}} - GOV.UK
{% endblock %}

{% if not backLink %}
    {% set backLink = 'javascript:history.back();' %}
{% endif %}
{% if not backText %}
    {% set backText = 'Back'  %}
{% endif %}

{% if backLink == 'false' %}
    {% set backLink = false %}
{% endif %}

{% if backText == 'false' %}
    {% set backText = '' %}
{% endif %}

{% block pageNavigation %}
  {% if backLink %}
    {{ govukBackLink({
      text: backText,
      href: backLink
    }) }}
  {% endif %}
{% endblock %}

{% block content %}

  {# This is the 'successful' notification banner, it fires based on the route from each of the check your answers pages #}
  {% set successHtml %}
    <h3 class="govuk-notification-banner__heading">
      {{ query._flash | safe }}
    </h3>
  {% endset %}

  {% if query._flash %}
    {{ govukNotificationBanner({
      html: successHtml,
      type: "success",
      classes: "govuk-!-margin-top-4 govuk-!-margin-bottom-6"
    }) }}
  {% endif %}

  {% set enquiryHeading %}
    {% if data.questionDescription %}
      {{ data.questionDescription }}
    {% else %}
      Example enquiry name
    {% endif %}
  {% endset %}

  {% set casetype %}
  {# if its a new case #}
    {% if data.caseType == "foi" %}
      {# If its a FOI case esle fall back to Enquiry #}
      {# Freedom of Information request #}
      Request for spending figures
    {% elseif data.caseType == "complaint" %}
      Complaint
    {% else %}
      {# Enquiry #}
    {{ enquiryHeading }}
    {% endif %}
  {% endset %}
  
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-l govuk-!-margin-bottom-4">
        <span class="govuk-caption-l">{{ casetype }}</span>
        Manage your case
        <div class="app-status govuk-!-margin-left-1" style="display: inline-block">
          <span class="govuk-visually-hidden">Status</span>
          
          {% if data.manage.case == "caseNew" %}
            
            {% if data.confirmClosed == "true" %}
              {{govukTag({
                text: "Closed",
                classes: "govuk-tag--grey"
              })}}
            {% else %}
              {{govukTag({
                text: "Open",
                classes: "govuk-tag--blue"
              })}}
            {% endif %}

          {% endif %}
         
          {% if data.caseType == "enquiryOld" %}
            
            {% if data.confirmClosed == "true" %}
              {{govukTag({
                text: "Transferred",
                classes: "govuk-tag--grey"
              })}}
            {% else %}
              {{govukTag({
                text: "Transferred",
                classes: "govuk-tag--grey"
              })}}
            {% endif %}

          {% endif %}
          
          {% if data.caseType == "enquiryNew" %}
            
            {% if data.confirmClosed == "true" %}
              {{govukTag({
                text: "Transferred",
                classes: "govuk-tag--grey"
              })}}
            {% else %}
              {{govukTag({
                text: "Open",
                classes: "govuk-tag--blue"
              })}}
            {% endif %}

          {% endif %}


          {% if data.settings.caseReview  == "Is able to request review" and data.confirmReviewRequest == "true" %}
            {{govukTag({
              text: "Review requested",
              classes: "govuk-tag--pink"
            })}}
          {% elseif data.settings.caseReview  == "Is able to request review" and data.confirmClosed != "true" %}
            {{govukTag({
              text: "Outcome reached",
              classes: "govuk-tag--blue"
            })}}
          {% endif %}
      </h1>

      {# <a href="/manage?caseType=complaint" class="govuk-link govuk-body">complaint</a>
      <a href="/manage?caseType=enquiry" class="govuk-link govuk-body">enquiry</a>
      <a href="/manage?caseType=foi" class="govuk-link govuk-body">foi</a>

      {% if data.caseType == "complaint" %}
        complaint
      {% endif %}
     
      {% if data.caseType == "enquiry" %}
        enquiry
      {% endif %}
      
      {% if data.caseType == "foi" %}
        foi
      {% endif %} #}


        <div class="govuk-button-group govuk-!-margin-bottom-2 govuk-!-margin-top-6">
          {{ govukButton({
            text: "Send a message to Ofqual",
            _classes: "govuk-button--secondary",
            href: "/manage/send"
          }) }} 
          {% if data.settings.caseReview == "Is able to request review" and data.confirmReviewRequest != "true"%}
            {{ govukButton({
              text: "Request review of outcome",
              classes: "govuk-button--secondary",
              href: "./../manage/request-review"
            }) }}
          {% endif %}
        </div>

    </div>

  </div>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      {% include "_includes/manage-nav.html" %}
    </div>
  </div>

  {% block manageContent %}
  {% endblock %}


{% endblock %}



